<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tasa de Carga â€” FEPASA</title>
<style>
  body { margin: 0; background: white; font-family: Arial, sans-serif; }
  text { fill: #222; font-size: 12px; }
  .axis { stroke: #ccc; stroke-width: 1; }
  .linea { stroke-width: 2; stroke-dasharray: 4; }
  .azul { fill: #0077FF; }
  .amarillo { fill: #FFD200; }
</style>
</head>
<body>
<svg id="grafico" width="600" height="320" xmlns="http://www.w3.org/2000/svg">
  <text x="20" y="30" font-size="16" font-weight="bold">Cargando datos...</text>
</svg>

<script>
const svg = document.getElementById("grafico");
const p = new URLSearchParams(window.location.search);

// ğŸ”¹ ParÃ¡metros desde AppSheet
const desde = p.get("desde") || "-";
const hasta = p.get("hasta") || "-";
const tren = p.get("tren") || "-";
const subtrenadas = (p.get("subtrenada") || "").split(",");
const tasaL2 = parseFloat(p.get("tasaL2") || 0);
const tasaL3 = parseFloat(p.get("tasaL3") || 0);

// ğŸ”¹ LÃ­neas de diseÃ±o (fijas)
const disenoL2 = 5.45;
const disenoL3 = 7.11;

// ğŸ”¹ ConfiguraciÃ³n grÃ¡fica
const maxY = 10;
const anchoBarra = 40;
const separacion = 100;
const baseY = 250;

svg.innerHTML = `
  <text x="20" y="25" font-size="16" font-weight="bold">Tasa de Carga Promedio â€” Tren ${tren}</text>
  <text x="20" y="45">Desde: ${desde} | Hasta: ${hasta}</text>

  <!-- Eje Y -->
  <line x1="40" y1="50" x2="40" y2="${baseY}" class="axis" />
  <line x1="40" y1="${baseY}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY}" class="axis" />

  <!-- LÃ­neas de diseÃ±o -->
  <line x1="40" y1="${baseY - disenoL2*20}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY - disenoL2*20}" class="linea" stroke="#0077FF"/>
  <text x="${(subtrenadas.length*separacion)+65}" y="${baseY - disenoL2*20+4}" fill="#0077FF" font-size="10">L2 DiseÃ±o (5.45)</text>

  <line x1="40" y1="${baseY - disenoL3*20}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY - disenoL3*20}" class="linea" stroke="#FFD200"/>
  <text x="${(subtrenadas.length*separacion)+65}" y="${baseY - disenoL3*20+4}" fill="#FFD200" font-size="10">L3 DiseÃ±o (7.11)</text>

  <!-- Barras dinÃ¡micas -->
  ${subtrenadas.map((s, i) => `
    <rect x="${60 + i*separacion}" y="${baseY - tasaL2*20}" width="${anchoBarra}" height="${tasaL2*20}" class="azul"/>
    <rect x="${60 + i*separacion + anchoBarra + 5}" y="${baseY - tasaL3*20}" width="${anchoBarra}" height="${tasaL3*20}" class="amarillo"/>
    <text x="${60 + i*separacion + 10}" y="${baseY + 15}" font-size="11">${s}</text>
  `).join("")}

  <!-- Leyenda -->
  <rect x="60" y="280" width="10" height="10" fill="#0077FF"/>
  <text x="75" y="289">Tasa L2</text>
  <rect x="150" y="280" width="10" height="10" fill="#FFD200"/>
  <text x="165" y="289">Tasa L3</text>
  <line x1="240" y1="285" x2="250" y2="285" stroke="#0077FF" stroke-width="2" stroke-dasharray="4"/>
  <text x="255" y="289">DiseÃ±o L2 (5.45)</text>
  <line x1="360" y1="285" x2="370" y2="285" stroke="#FFD200" stroke-width="2" stroke-dasharray="4"/>
  <text x="375" y="289">DiseÃ±o L3 (7.11)</text>
`;
</script>
</body>
</html>
