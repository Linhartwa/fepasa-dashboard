<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tasa de Carga â€” FEPASA</title>
<style>
  body {
    margin: 0;
    background: white;
    font-family: Arial, sans-serif;
  }
  text { fill: #222; font-size: 12px; }
  .axis { stroke: #ccc; stroke-width: 1; }
  .linea { stroke-width: 2; stroke-dasharray: 4; }
  .azul { fill: #0077FF; }
  .amarillo { fill: #FFD200; }
  .valor { font-weight: bold; font-size: 11px; fill: #000; }
</style>
</head>
<body>
<svg id="grafico" width="640" height="340" xmlns="http://www.w3.org/2000/svg">
  <text x="20" y="30" font-size="16" font-weight="bold">Cargando datos...</text>
</svg>

<script>
const svg = document.getElementById("grafico");
const p = new URLSearchParams(window.location.search);

// ðŸ”¹ ParÃ¡metros desde AppSheet
const desde = p.get("desde") || "-";
const hasta = p.get("hasta") || "-";
const tren = p.get("tren") || "-";
const subtrenadas = (p.get("subtrenada") || "").split(",").filter(s => s.trim() !== "");
const tasaL2 = parseFloat(p.get("tasaL2") || 0);
const tasaL3 = parseFloat(p.get("tasaL3") || 0);

// ðŸ”¹ LÃ­neas de diseÃ±o (fijas)
const disenoL2 = 5.45;
const disenoL3 = 7.11;

// ðŸ”¹ ConfiguraciÃ³n grÃ¡fica
const maxY = 10;
const baseY = 260;
const anchoBarra = 35;
const separacion = 100;
const escala = 20; // 1 unidad = 20px en el eje Y

// ðŸ”¹ Generar SVG dinÃ¡mico
svg.innerHTML = `
  <text x="20" y="25" font-size="16" font-weight="bold">Tasa de Carga Promedio â€” Tren ${tren}</text>
  <text x="20" y="45" font-size="12">Desde: ${desde} | Hasta: ${hasta}</text>

  <!-- Eje Y -->
  <line x1="40" y1="50" x2="40" y2="${baseY}" class="axis" />
  <line x1="40" y1="${baseY}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY}" class="axis" />

  <!-- LÃ­neas de diseÃ±o -->
  <line x1="40" y1="${baseY - disenoL2*escala}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY - disenoL2*escala}" class="linea" stroke="#0077FF"/>
  <text x="${(subtrenadas.length*separacion)+70}" y="${baseY - disenoL2*escala + 4}" fill="#0077FF" font-size="10">L2 DiseÃ±o (5.45)</text>

  <line x1="40" y1="${baseY - disenoL3*escala}" x2="${(subtrenadas.length*separacion)+60}" y2="${baseY - disenoL3*escala}" class="linea" stroke="#FFD200"/>
  <text x="${(subtrenadas.length*separacion)+70}" y="${baseY - disenoL3*escala + 4}" fill="#FFD200" font-size="10">L3 DiseÃ±o (7.11)</text>

  <!-- Barras dinÃ¡micas -->
  ${subtrenadas.map((s, i) => `
    <!-- L2 -->
    <rect x="${60 + i*separacion}" y="${baseY - tasaL2*escala}" width="${anchoBarra}" height="${tasaL2*escala}" class="azul"/>
    <text x="${60 + i*separacion + anchoBarra/2 - 8}" y="${baseY - tasaL2*escala - 5}" class="valor">${tasaL2.toFixed(2)}</text>

    <!-- L3 -->
    <rect x="${60 + i*separacion + anchoBarra + 5}" y="${baseY - tasaL3*escala}" width="${anchoBarra}" height="${tasaL3*escala}" class="amarillo"/>
    <text x="${60 + i*separacion + anchoBarra + 5 + anchoBarra/2 - 8}" y="${baseY - tasaL3*escala - 5}" class="valor">${tasaL3.toFixed(2)}</text>

    <!-- Etiquetas -->
    <text x="${60 + i*separacion + 15}" y="${baseY + 18}" font-size="11">${s}</text>
  `).join("")}

  <!-- Leyenda -->
  <rect x="60" y="300" width="10" height="10" fill="#0077FF"/>
  <text x="75" y="309">Tasa L2</text>
  <rect x="150" y="300" width="10" height="10" fill="#FFD200"/>
  <text x="165" y="309">Tasa L3</text>
  <line x1="240" y1="305" x2="250" y2="305" stroke="#0077FF" stroke-width="2" stroke-dasharray="4"/>
  <text x="255" y="309">DiseÃ±o L2 (5.45)</text>
  <line x1="360" y1="305" x2="370" y2="305" stroke="#FFD200" stroke-width="2" stroke-dasharray="4"/>
  <text x="375" y="309">DiseÃ±o L3 (7.11)</text>
`;
</script>
</body>
</html>

