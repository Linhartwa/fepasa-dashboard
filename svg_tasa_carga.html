<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasa de Carga por Subtrenada</title>
<style>
  body {
    background: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }
  svg {
    width: 100%;
    height: 300px;
  }
  .label {
    font-size: 12px;
    fill: #333;
    text-anchor: middle;
  }
  .value {
    font-size: 11px;
    fill: #000;
    text-anchor: middle;
  }
  .linea-diseno {
    stroke-dasharray: 4;
    stroke-width: 2;
  }
</style>
</head>
<body>

<svg id="grafico" viewBox="0 0 600 320"></svg>

<script>
function getParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

// Recibe los parámetros de AppSheet (listas separadas por coma)
const subtrenadas = (getParam("subtrenada_planificada") || "").split(",");
const tasasL2 = (getParam("tasaL2") || "").split(",");
const tasasL3 = (getParam("tasaL3") || "").split(",");
const lineas = (getParam("linea") || "").split(",");

const svg = document.getElementById("grafico");
const baseY = 260;
const maxTasa = 10; // escala general de referencia
const escala = v => (v / maxTasa) * 200;

// Líneas de diseño
svg.innerHTML += `
  <line x1="40" y1="${baseY - escala(5.45)}" x2="560" y2="${baseY - escala(5.45)}" stroke="blue" class="linea-diseno" />
  <text x="565" y="${baseY - escala(5.45) + 4}" font-size="11" fill="blue">Diseño L2 (5.45)</text>

  <line x1="40" y1="${baseY - escala(7.11)}" x2="560" y2="${baseY - escala(7.11)}" stroke="orange" class="linea-diseno" />
  <text x="565" y="${baseY - escala(7.11) + 4}" font-size="11" fill="orange">Diseño L3 (7.11)</text>
`;

// Dibujar las barras por subtrenada
subtrenadas.forEach((st, i) => {
  const x = 60 + i * 80;
  const linea = (lineas[i] || "").trim();
  let tasa = 0, color = "gray";

  if (linea === "2") {
    tasa = parseFloat(tasasL2[i]) || 0;
    color = "blue";
  } else if (linea === "3") {
    tasa = parseFloat(tasasL3[i]) || 0;
    color = "orange";
  }

  const altura = escala(tasa);
  const y = baseY - altura;

  svg.innerHTML += `
    <rect x="${x}" y="${y}" width="50" height="${altura}" fill="${color}" rx="4"/>
    <text x="${x + 25}" y="${y - 8}" class="value">${tasa.toFixed(2)} h</text>
    <text x="${x + 25}" y="${baseY + 15}" class="label">${st}</text>
  `;
});
</script>

</body>
</html>

