<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasa de Carga por Subtrenada</title>
<style>
  body { background:#fff; font-family:Arial,sans-serif; margin:0; text-align:center; }
  svg { width:100%; height:340px; }
  .label { font-size:11px; fill:#333; font-weight:bold; text-anchor:middle; }
  .valor { font-size:11px; fill:#111; font-weight:bold; text-anchor:middle; }
  .linea-diseno { stroke-dasharray:4; stroke-width:2; }
  table {
    width:90%;
    border-collapse:collapse;
    margin:20px auto;
    font-size:13px;
  }
  th, td {
    border:1px solid #ccc;
    padding:6px 8px;
  }
  th { background:#f2f2f2; }
  tr:nth-child(even) { background:#fafafa; }
</style>
</head>
<body>

<svg id="grafico" viewBox="0 0 620 340"></svg>
<div id="tabla"></div>

<script>
// ---- Leer par치metros desde la URL ----
const p = new URLSearchParams(window.location.search);
const tasaL2 = parseFloat(p.get("tasaL2")) || 0;
const tasaL3 = parseFloat(p.get("tasaL3")) || 0;
const subtrenadas = (p.get("subtrenada_planificada") || "")
  .split(",")
  .filter(s => s.trim() !== "");
const cierres = (p.get("fecha_cierre") || "")
  .split(",")
  .filter(s => s.trim() !== "");

// ---- Par치metros de dise침o ----
const svg = document.getElementById("grafico");
const baseY = 260;
const escala = 20; // 1 unidad = 20px
const ancho = 30;
const separacion = 90;

// ---- L칤neas de dise침o ----
const lineas = [
  { y: 5.45, color: "#0077FF", label: "Dise침o L2 (5.45)" },
  { y: 7.11, color: "#FFD200", label: "Dise침o L3 (7.11)" }
];

// ---- Dibujar encabezado ----
svg.innerHTML = `
  <text x="20" y="25" font-size="16" font-weight="bold">Tasa de Carga Promedio</text>
  <text x="20" y="45" font-size="12">Fechas de cierre: ${cierres.join(" | ")}</text>
  <line x1="40" y1="${baseY}" x2="${subtrenadas.length * separacion + 100}" y2="${baseY}" stroke="#888" stroke-width="1"/>
`;

// ---- Dibujar l칤neas de dise침o ----
lineas.forEach(l => {
  const y = baseY - l.y * escala;
  svg.innerHTML += `
    <line x1="40" y1="${y}" x2="${subtrenadas.length * separacion + 100}" y2="${y}" stroke="${l.color}" class="linea-diseno"/>
    <text x="${subtrenadas.length * separacion + 110}" y="${y + 4}" font-size="10" fill="${l.color}">${l.label}</text>
  `;
});

// ---- Dibujar barras ----
subtrenadas.forEach((s, i) => {
  const xL2 = 60 + i * separacion;
  const xL3 = xL2 + ancho + 5;
  const hL2 = tasaL2 * escala;
  const hL3 = tasaL3 * escala;

  svg.innerHTML += `
    <!-- Barras -->
    <rect x="${xL2}" y="${baseY - hL2}" width="${ancho}" height="${hL2}" fill="#0077FF" rx="3"/>
    <rect x="${xL3}" y="${baseY - hL3}" width="${ancho}" height="${hL3}" fill="#FFD200" rx="3"/>

    <!-- Valores -->
    <text x="${xL2 + ancho/2}" y="${baseY - hL2 - 6}" class="valor">${tasaL2.toFixed(2)}</text>
    <text x="${xL3 + ancho/2}" y="${baseY - hL3 - 6}" class="valor">${tasaL3.toFixed(2)}</text>

    <!-- Etiqueta subtrenada -->
    <text x="${xL2 + ancho/2 + 20}" y="${baseY + 18}" class="label">${s}</text>
  `;
});

// ---- Leyenda ----
svg.innerHTML += `
  <rect x="60" y="310" width="12" height="12" fill="#0077FF"/>
  <text x="78" y="320" font-size="11">Tasa L2</text>
  <rect x="150" y="310" width="12" height="12" fill="#FFD200"/>
  <text x="168" y="320" font-size="11">Tasa L3</text>
  <line x1="240" y1="316" x2="252" y2="316" stroke="#0077FF" stroke-width="2" stroke-dasharray="4"/>
  <text x="260" y="320" font-size="11" fill="#0077FF">L2 Dise침o</text>
  <line x1="340" y1="316" x2="352" y2="316" stroke="#FFD200" stroke-width="2" stroke-dasharray="4"/>
  <text x="360" y="320" font-size="11" fill="#FFD200">L3 Dise침o</text>
`;

// ---- Generar tabla resumen ----
let tablaHTML = `
  <h3>游늶 Resumen de Subtrenadas</h3>
  <table>
    <thead>
      <tr>
        <th>Subtrenada Planificada</th>
        <th>Fecha y Hora de Cierre</th>
        <th>Tasa L2 (car/h)</th>
        <th>Tasa L3 (car/h)</th>
      </tr>
    </thead>
    <tbody>
`;

for (let i = 0; i < subtrenadas.length; i++) {
  const cierre = cierres[i] || "-";
  tablaHTML += `
    <tr>
      <td>${subtrenadas[i]}</td>
      <td>${cierre}</td>
      <td>${tasaL2.toFixed(2)}</td>
      <td>${tasaL3.toFixed(2)}</td>
    </tr>
  `;
}

tablaHTML += `</tbody></table>`;
document.getElementById("tabla").innerHTML = tablaHTML;
</script>
</body>
</html>

