<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ðŸ“Š Tasa de Carga por Subtrenada</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #fafafa; }
  svg { border: 1px solid #ccc; background: #fff; }
  .grid { stroke: #ddd; stroke-width: 0.5; }
  .label { font-size: 12px; fill: #333; }
  .axis-label { font-size: 14px; font-weight: bold; fill: #003366; }
  .linea-diseno { stroke-dasharray: 6,4; stroke-width: 2; }
</style>
</head>
<body>
<h2>ðŸ“Š Tasa de Carga por Subtrenada</h2>
<svg id="chart" width="950" height="480"></svg>
<table border="1" cellpadding="6" style="margin:auto; margin-top:15px; border-collapse:collapse;">
<thead style="background:#ddd;">
<tr><th>Subtrenada</th><th>Tasa L2</th><th>Tasa L3</th></tr>
</thead>
<tbody id="tablaResumen"></tbody>
</table>

<script>
const params = new URLSearchParams(window.location.search);
const subtrenadas = params.get("subtrenada_planificada")?.split(",") || [];
const tasaL2 = (params.get("tasaL2")?.split(",") || []).map(Number);
const tasaL3 = (params.get("tasaL3")?.split(",") || []).map(Number);

const svg = document.getElementById("chart");
const width = 950, height = 480;
const marginLeft = 100, marginBottom = 90, marginTop = 60, marginRight = 60;
const barWidth = 40, gap = 80;
const maxY = Math.max(10, ...tasaL2, ...tasaL3, 8);
const scaleY = (height - marginBottom - marginTop) / maxY;

for (let i = 0; i <= maxY; i += 1) {
  const y = height - marginBottom - i * scaleY;
  svg.innerHTML += `<line x1="${marginLeft}" y1="${y}" x2="${width - marginRight}" y2="${y}" class="grid"/>`;
  svg.innerHTML += `<text x="${marginLeft - 35}" y="${y + 4}" font-size="11" fill="#555" text-anchor="end">${i.toFixed(1)}</text>`;
}

// Barras
subtrenadas.forEach((st, i) => {
  const x = marginLeft + i * (gap + barWidth);
  const yL2 = height - marginBottom - (tasaL2[i] || 0) * scaleY;
  const yL3 = height - marginBottom - (tasaL3[i] || 0) * scaleY;

  // Barra azul L2
  svg.innerHTML += `<rect x="${x}" y="${yL2}" width="${barWidth}" height="${(tasaL2[i] || 0) * scaleY}" fill="#007BFF"></rect>`;
  svg.innerHTML += `<text x="${x + barWidth/2}" y="${yL2 - 5}" text-anchor="middle" fill="#003366" font-size="12">${(tasaL2[i] || 0).toFixed(2)}</text>`;

  // Barra amarilla L3
  svg.innerHTML += `<rect x="${x + barWidth + 10}" y="${yL3}" width="${barWidth}" height="${(tasaL3[i] || 0) * scaleY}" fill="#FFB600"></rect>`;
  svg.innerHTML += `<text x="${x + barWidth + 10 + barWidth/2}" y="${yL3 - 5}" text-anchor="middle" fill="#805800" font-size="12">${(tasaL3[i] || 0).toFixed(2)}</text>`;

  svg.innerHTML += `<text x="${x + barWidth + 5}" y="${height - marginBottom + 30}" font-size="12" fill="#333" text-anchor="middle">${st}</text>`;
});

// LÃ­neas de referencia de diseÃ±o
const lineaL2 = 5.45 * scaleY;
const lineaL3 = 7.11 * scaleY;
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom - lineaL2}" x2="${width - marginRight}" y2="${height - marginBottom - lineaL2}" stroke="#004C99" class="linea-diseno"/>`;
svg.innerHTML += `<text x="${width - marginRight + 5}" y="${height - marginBottom - lineaL2 + 4}" font-size="12" fill="#004C99">L2 DiseÃ±o 5.45</text>`;
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom - lineaL3}" x2="${width - marginRight}" y2="${height - marginBottom - lineaL3}" stroke="#FFB600" class="linea-diseno"/>`;
svg.innerHTML += `<text x="${width - marginRight + 5}" y="${height - marginBottom - lineaL3 + 4}" font-size="12" fill="#805800">L3 DiseÃ±o 7.11</text>`;

// Ejes y etiquetas
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom}" x2="${width - marginRight}" y2="${height - marginBottom}" stroke="#333" stroke-width="1.5"/>`;
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom}" x2="${marginLeft}" y2="${marginTop}" stroke="#333" stroke-width="1.5"/>`;
svg.innerHTML += `<text x="${width/2}" y="${height - 25}" class="axis-label" text-anchor="middle">Subtrenada Planificada</text>`;
svg.innerHTML += `<text x="25" y="${height/2}" class="axis-label" transform="rotate(-90,25,${height/2})" text-anchor="middle">Tasa de Carga (car/h)</text>`;

// Tabla resumen
const tbody = document.querySelector("#tablaResumen tbody");
tbody.innerHTML = "";
subtrenadas.forEach((st, i) => {
  tbody.innerHTML += `<tr><td>${st}</td><td>${(tasaL2[i] || 0).toFixed(2)}</td><td>${(tasaL3[i] || 0).toFixed(2)}</td></tr>`;
});
</script>
</body>
</html>




