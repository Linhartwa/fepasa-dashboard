<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>⏱ Tiempos de Proceso</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #fafafa; }
  svg { border: 1px solid #ccc; background: #fff; }
  .grid { stroke: #ddd; stroke-width: 0.5; }
  .label { font-size: 12px; fill: #333; }
  .axis-label { font-size: 14px; font-weight: bold; fill: #003366; }
</style>
</head>
<body>
<h2>⏱ Tiempos de Proceso por Subtrenada</h2>
<svg id="chart" width="950" height="480"></svg>
<table border="1" cellpadding="6" style="margin:auto; margin-top:15px; border-collapse:collapse;">
<thead style="background:#ddd;">
<tr><th>Subtrenada</th><th>Aviso–Retiro</th><th>Retiro–Postura</th></tr>
</thead>
<tbody id="tablaResumen"></tbody>
</table>

<script>
const params = new URLSearchParams(window.location.search);
const subtrenadas = params.get("subtrenada_planificada")?.split(",") || [];
const avisoRetiro = (params.get("aviso_retiro")?.split(",") || []).map(Number);
const retiroPostura = (params.get("retiro_postura")?.split(",") || []).map(Number);

const svg = document.getElementById("chart");
const width = 950, height = 480;
const marginLeft = 100, marginBottom = 90, marginTop = 60, marginRight = 60;
const barWidth = 40, gap = 80;
const maxY = Math.max(10, ...avisoRetiro, ...retiroPostura);
const scaleY = (height - marginBottom - marginTop) / maxY;

for (let i = 0; i <= maxY; i += 5) {
  const y = height - marginBottom - i * scaleY;
  svg.innerHTML += `<line x1="${marginLeft}" y1="${y}" x2="${width - marginRight}" y2="${y}" class="grid"/>`;
  svg.innerHTML += `<text x="${marginLeft - 35}" y="${y + 4}" font-size="11" fill="#555" text-anchor="end">${i}</text>`;
}

// Barras
subtrenadas.forEach((st, i) => {
  const x = marginLeft + i * (gap + barWidth);
  const yAviso = height - marginBottom - (avisoRetiro[i] || 0) * scaleY;
  const yRetiro = height - marginBottom - (retiroPostura[i] || 0) * scaleY;

  // Azul: Aviso–Retiro
  svg.innerHTML += `<rect x="${x}" y="${yAviso}" width="${barWidth}" height="${(avisoRetiro[i] || 0) * scaleY}" fill="#007BFF"></rect>`;
  svg.innerHTML += `<text x="${x + barWidth/2}" y="${yAviso - 5}" text-anchor="middle" fill="#003366" font-size="12">${(avisoRetiro[i] || 0).toFixed(0)}</text>`;

  // Amarillo: Retiro–Postura
  svg.innerHTML += `<rect x="${x + barWidth + 10}" y="${yRetiro}" width="${barWidth}" height="${(retiroPostura[i] || 0) * scaleY}" fill="#FFB600"></rect>`;
  svg.innerHTML += `<text x="${x + barWidth + 10 + barWidth/2}" y="${yRetiro - 5}" text-anchor="middle" fill="#805800" font-size="12">${(retiroPostura[i] || 0).toFixed(0)}</text>`;

  svg.innerHTML += `<text x="${x + barWidth + 5}" y="${height - marginBottom + 30}" font-size="12" fill="#333" text-anchor="middle">${st}</text>`;
});

// Ejes
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom}" x2="${width - marginRight}" y2="${height - marginBottom}" stroke="#333" stroke-width="1.5"/>`;
svg.innerHTML += `<line x1="${marginLeft}" y1="${height - marginBottom}" x2="${marginLeft}" y2="${marginTop}" stroke="#333" stroke-width="1.5"/>`;
svg.innerHTML += `<text x="${width/2}" y="${height - 25}" class="axis-label" text-anchor="middle">Subtrenada Planificada</text>`;
svg.innerHTML += `<text x="25" y="${height/2}" class="axis-label" transform="rotate(-90,25,${height/2})" text-anchor="middle">Tiempo (min)</text>`;

// Tabla resumen
const tbody = document.querySelector("#tablaResumen tbody");
tbody.innerHTML = "";
subtrenadas.forEach((st, i) => {
  tbody.innerHTML += `<tr><td>${st}</td><td>${(avisoRetiro[i] || 0).toFixed(0)}</td><td>${(retiroPostura[i] || 0).toFixed(0)}</td></tr>`;
});
</script>
</body>
</html>

