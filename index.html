<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üìä An√°lisis de Carga - FEPASA</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Segoe UI, Arial; background:#f7f9fb; margin:0 }
    header { background:#003366; color:white; padding:12px 24px; display:flex; align-items:center }
    header img { height:45px; margin-right:12px }
    .container { padding:24px }

    table {
      width:100%;
      border-collapse:collapse;
      background:white;
      box-shadow:0 3px 6px rgba(0,0,0,.1);
      margin-top:20px
    }
    th { background:#003366; color:white; padding:8px }
    td { padding:8px; text-align:center; border-bottom:1px solid #ddd }

    .cumple { background:#d4edda; color:#155724; font-weight:bold }
    .nocumple { background:#f8d7da; color:#721c24; font-weight:bold }

    .charts { display:flex; gap:30px; flex-wrap:wrap }
    canvas { height:320px }
  </style>
</head>

<body>

<header>
  <img src="https://www.fepasa.com/wp-content/uploads/2023/03/LOGO-FEPASA-VECTORIAL-1.png">
  <h2 id="titulo"></h2>
</header>

<div class="container">

  <table id="tablaDatos">
    <thead id="filaCumplimiento"></thead>
    <thead>
      <tr>
        <th>Subtrenada</th>
        <th>L√≠nea</th>
        <th>Postura</th>
        <th>Aviso</th>
        <th>Retiro</th>
        <th>Carros</th>
        <th>Tiempo Carga</th>
        <th>Av-Ret</th>
        <th>Ret-Post</th>
        <th>Tasa</th>
        <th>Eficiencia</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="charts">
    <canvas id="tasaChart"></canvas>
    <canvas id="tiempoChart"></canvas>
  </div>

</div>

<script>
const p = new URLSearchParams(window.location.search);

// === PARAMETROS BASE ===
const tren = p.get("tren") || "";
const folio = p.get("folio") || "";
const horaDiseno = p.get("horaDisenoInicio");
const horaReal = p.get("horaRealInicio");

// === LISTAS ===
const list = (k) => (p.get(k)||"").split(",").map(v=>v.trim());
const num  = (k) => list(k).map(v=>Number(v)||0);

const subtrenadas = list("subtrenadas");
const lineas = list("linea");
const postura = list("postura");
const aviso = list("aviso");
const retiro = list("retiro");
const cargados = num("cargados");
const avRet = num("avisoRetiro");
const avPost = num("avisoPostura");
const tasa = num("tasaCarga");
const eficiencia = num("eficiencia");

// === TITULO ===
document.getElementById("titulo").innerText =
  `üìä An√°lisis de Carga ‚Äì Tren ${tren} (${folio})`;

// === CUMPLIMIENTO ===
const cumple = horaReal && horaDiseno && new Date(horaReal) <= new Date(horaDiseno);

document.getElementById("filaCumplimiento").innerHTML = `
<tr class="${cumple ? 'cumple' : 'nocumple'}">
  <th colspan="3">Inicio Dise√±o</th>
  <th colspan="3">${horaDiseno || "-"}</th>
  <th colspan="3">Inicio Real</th>
  <th colspan="2">${horaReal || "-"}</th>
</tr>
<tr class="${cumple ? 'cumple' : 'nocumple'}">
  <th colspan="11">${cumple ? "‚úÖ CUMPLE HORARIO DE DISE√ëO" : "‚ùå NO CUMPLE HORARIO DE DISE√ëO"}</th>
</tr>`;

// === TABLA ===
const tbody = document.querySelector("tbody");
subtrenadas.forEach((_,i)=>{
  const tr = document.createElement("tr");
  [
    subtrenadas[i], lineas[i], postura[i], aviso[i], retiro[i],
    cargados[i], "-", avRet[i], avPost[i], tasa[i], eficiencia[i]
  ].forEach(v=>{
    const td=document.createElement("td");
    td.textContent=v;
    tr.appendChild(td);
  });
  tbody.appendChild(tr);
});

// === GRAFICOS ===
new Chart(tasaChart,{
  type:"bar",
  data:{labels:subtrenadas,datasets:[{label:"Tasa Carga",data:tasa}]}
});

new Chart(tiempoChart,{
  type:"bar",
  data:{
    labels:subtrenadas,
    datasets:[
      {label:"Aviso-Retiro",data:avRet},
      {label:"Retiro-Postura",data:avPost}
    ]
  }
});
</script>

</body>
</html>
